<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="page-title">í”¼ë¶€ ê³ ë¯¼ ì„ íƒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input[type="checkbox"]:checked {
      accent-color: #fed7aa;
    }
  </style>
</head>
<body class="bg-white text-gray-800 font-sans">
  <div class="max-w-md mx-auto p-6">
    <h1 id="title" class="text-2xl font-bold mb-2 text-center">í”¼ë¶€ ê³ ë¯¼ì€ ë¬´ì—‡ì¸ê°€ìš”?</h1>
    <p id="subtitle" class="text-sm text-center text-gray-600 mb-6">ë‘ ê°€ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</p>

    <form id="skin-form" class="space-y-4">
      <div class="space-y-2" id="checkbox-container"></div>
      <button type="submit" class="w-full bg-orange-200 hover:bg-orange-300 text-black font-semibold py-2 px-4 rounded-lg shadow" id="submit-button">ì œì¶œ</button>
    </form>
  </div>

  <script>
    const lang = localStorage.getItem("selectedLanguage") || "Korean";

    const langKey = {
      Korean: "kor", English: "eng", Chinese: "chn", Japanese: "jpn",
      Vietnamese: "vie", Indonesian: "id", Russian: "ru"
    };

    const concernList = [
      { kor: "ë¯¼ê°ì„±", eng: "Sensitive", chn: "æ•æ„Ÿ", jpn: "æ•æ„Ÿè‚Œ", vie: "Da nháº¡y cáº£m", id: "Kulit Sensitif", ru: "Ğ§ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¶Ğ°" },
      { kor: "ê±´ì„±", eng: "Dry", chn: "å¹²æ€§", jpn: "ä¹¾ç‡¥è‚Œ", vie: "Da khÃ´", id: "Kering", ru: "Ğ¡ÑƒÑ…Ğ°Ñ" },
      { kor: "ì§€ì„±", eng: "Oily", chn: "æ²¹æ€§", jpn: "è„‚æ€§è‚Œ", vie: "Da dáº§u", id: "Berminyak", ru: "Ğ–Ğ¸Ñ€Ğ½Ğ°Ñ" },
      { kor: "ë³µí•©ì„±(ê±´ì„±ê³¼ ì§€ì„± í˜¼í•©)", eng: "Combination", chn: "æ··åˆæ€§", jpn: "æ··åˆæ€§", vie: "Da há»—n há»£p", id: "Campuran", ru: "ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ" },
      { kor: "ì—¬ë“œë¦„", eng: "Acne", chn: "ç—˜ç—˜", jpn: "ãƒ‹ã‚­ãƒ“", vie: "Má»¥n", id: "Jerawat", ru: "ĞĞºĞ½Ğµ" },
      { kor: "ëª¨ê³µ ì¶•ì†Œ", eng: "Pore Care", chn: "æ¯›å­”æŠ¤ç†", jpn: "æ¯›ç©´ã‚±ã‚¢", vie: "Lá»— chÃ¢n lÃ´ng", id: "Pori", ru: "ĞŸĞ¾Ñ€Ñ‹" },
      { kor: "ìˆ˜ë¶„ ê³µê¸‰", eng: "Hydration", chn: "è¡¥æ°´", jpn: "ä¿æ¹¿", vie: "Cáº¥p nÆ°á»›c", id: "Melembapkan", ru: "Ğ£Ğ²Ğ»Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ" },
      { kor: "í”¼ì§€ ì¡°ì ˆ", eng: "Oil Control", chn: "æ§æ²¹", jpn: "çš®è„‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«", vie: "Kiá»ƒm soÃ¡t dáº§u", id: "Kontrol Minyak", ru: "ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ¶Ğ¸Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸" },
      { kor: "ì£¼ë¦„ ê°œì„ ", eng: "Anti-Wrinkle", chn: "æŠ—çš±", jpn: "ã‚·ãƒ¯å¯¾ç­–", vie: "Chá»‘ng nhÄƒn", id: "Anti-Kerut", ru: "ĞŸÑ€Ğ¾Ñ‚Ğ¸Ğ² Ğ¼Ğ¾Ñ€Ñ‰Ğ¸Ğ½" },
      { kor: "ë¯¸ë°±", eng: "Whitening", chn: "ç¾ç™½", jpn: "ç¾ç™½", vie: "LÃ m tráº¯ng", id: "Pemutih", ru: "ĞÑĞ²ĞµÑ‚Ğ»ĞµĞ½Ğ¸Ğµ" },
      { kor: "ê¸°ë¯¸Â·ì¡í‹°(ì œê±°)", eng: "Spot Removal", chn: "ç¥›æ–‘", jpn: "ã‚·ãƒŸï¼ˆé™¤å»ï¼‰", vie: "Äá»‘m", id: "Bintik", ru: "ĞŸĞ¸Ğ³Ğ¼ĞµĞ½Ñ‚Ğ½Ñ‹Ğµ Ğ¿ÑÑ‚Ğ½Ğ°" },
      { kor: "í‰í„°(ì œê±°)", eng: "Scar Removal", chn: "ç¥›ç–¤", jpn: "å‚·è·¡ï¼ˆé™¤å»ï¼‰", vie: "Sáº¹o", id: "Luka", ru: "Ğ¨Ñ€Ğ°Ğ¼Ñ‹" }
    ];

    const texts = {
      Korean: {
        title: "í”¼ë¶€ ê³ ë¯¼ì€ ë¬´ì—‡ì¸ê°€ìš”?",
        subtitle: "ë‘ ê°€ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”",
        submit: "ë‚˜ì—ê²Œ ë§ëŠ” ì„±ë¶„ ì•Œì•„ë³´ê¸°",
        alert: "í”¼ë¶€ ê³ ë¯¼ì„ ë‘ ê°€ì§€ ì„ íƒí•´ ì£¼ì„¸ìš”."
      },
      English: {
        title: "What are your skin concerns?",
        subtitle: "Please choose two",
        submit: "Find the Right Ingredients for Me",
        alert: "Please select two skin concerns."
      },
      Chinese: {
        title: "æ‚¨çš„çš®è‚¤çƒ¦æ¼æ˜¯ä»€ä¹ˆï¼Ÿ",
        subtitle: "è¯·é€‰æ‹©ä¸¤ä¸ª",
        submit: "æ‰¾åˆ°é€‚åˆæˆ‘çš„æˆåˆ†",
        alert: "è¯·é€‰æ‹©ä¸¤ä¸ªçš®è‚¤çƒ¦æ¼ã€‚"
      },
      Japanese: {
        title: "ãŠè‚Œã®æ‚©ã¿ã¯ä½•ã§ã™ã‹ï¼Ÿ",
        subtitle: "2ã¤é¸ã‚“ã§ãã ã•ã„",
        submit: "è‡ªåˆ†ã«åˆã£ãŸæˆåˆ†ã‚’è¦‹ã¤ã‘ã‚‹",
        alert: "2ã¤ã®è‚Œã®æ‚©ã¿ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚"
      },
      Vietnamese: {
        title: "Má»‘i quan tÃ¢m vá» da cá»§a báº¡n lÃ  gÃ¬?",
        subtitle: "HÃ£y chá»n hai",
        submit: "TÃ¬m hiá»ƒu thÃ nh pháº§n phÃ¹ há»£p vá»›i tÃ´i",
        alert: "Vui lÃ²ng chá»n hai má»‘i quan tÃ¢m vá» da."
      },
      Indonesian: {
        title: "Apa masalah kulit Anda?",
        subtitle: "Silakan pilih dua",
        submit: "Cari Tahu Kandungan yang Cocok untuk Saya",
        alert: "Silakan pilih dua masalah kulit."
      },
      Russian: {
        title: "ĞšĞ°ĞºĞ¸Ğµ Ñƒ Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ ĞºĞ¾Ğ¶ĞµĞ¹?",
        subtitle: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ²Ğ°",
        submit: "ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¼ĞµĞ½Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹",
        alert: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ²Ğ° Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°."
      }
    };

    const key = langKey[lang];
    const langText = texts[lang] || texts["Korean"]; // fallback ì²˜ë¦¬

    window.onload = () => {
      document.getElementById("title").textContent = langText.title;
      document.getElementById("subtitle").textContent = langText.subtitle;
      document.getElementById("submit-button").textContent = langText.submit;
      document.getElementById("page-title").textContent = langText.title;

      const container = document.getElementById("checkbox-container");
      concernList.forEach((item, index) => {
        const label = document.createElement("label");
        label.className = "flex items-center";
        label.innerHTML = `<input type="checkbox" class="mr-2" name="option${index+1}"/> ${item[key]}`;
        container.appendChild(label);
      });

      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(cb => {
        cb.addEventListener('change', () => {
          const checked = [...checkboxes].filter(cb => cb.checked);
          checkboxes.forEach(box => box.disabled = checked.length >= 2 && !box.checked);
        });
      });

      const form = document.getElementById("skin-form");
      form.addEventListener("submit", e => {
        e.preventDefault();
        const selected = [...checkboxes].filter(cb => cb.checked).map(cb => cb.parentElement.textContent.trim());
        if (selected.length !== 2) {
          alert(langText.alert);
          return;
        }

        const selectedKor = selected.map(sel => {
          const found = concernList.find(item => item[key] === sel);
          return found ? found.kor : sel;
        });

        const data = {
          language: localStorage.getItem("selectedLanguage") || "Korean",
          age: localStorage.getItem("user_age"),
          gender: localStorage.getItem("user_gender"),
          preferred_brand: localStorage.getItem("user_brand"),
          allergies: localStorage.getItem("user_allergy"),
          concern1: selectedKor[0],
          concern2: selectedKor[1],
        };

        Object.keys(data).forEach(key => {
          if (data[key] === undefined || data[key] === null) {
            delete data[key];
          }
        });

        sendToAirtableAndGo(data);
      });
    };

    async function sendToAirtableAndGo(data) {
      const airtableApiKey = 'Bearer patZYCOOyyBDeuciJ.96030290b2aa83dbc1605b5ce9c55903e3be7b066c3891101821b80cd6582a95';
      const baseId = 'apphc37JyCEAozVdD';
      const tableName = 'survey_responses';

      const url = `https://api.airtable.com/v0/${baseId}/${tableName}`;

      const response = await fetch(url, {
        method: 'POST',
        headers: {
          Authorization: airtableApiKey,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ fields: data }),
      });

      if (response.ok) {
        window.location.href = `page3.html?combo=${encodeURIComponent(data.concern1 + '+' + data.concern2)}`;
      } else {
        const errorText = await response.text();
        console.error("Airtable ì˜¤ë¥˜ ì‘ë‹µ:", errorText);
        alert("Airtable ì €ì¥ ì‹¤íŒ¨ ğŸ˜¢\n" + errorText);
      }
    }
  </script>
</body>
</html>
